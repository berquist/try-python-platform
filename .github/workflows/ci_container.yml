---
name: try Python platform module in Linux container

# yamllint disable-line rule:truthy
on:
  pull_request:
  push:

jobs:
  run-python-platform:
    name: ${{ matrix.image }}
    # name: image:${{ matrix.image }} / version:${{ matrix.python-version }}
    runs-on: ubuntu-22.04
    container:
      image: ${{ matrix.image }}
    strategy:
      matrix:
        image:
          - almalinux:8.10-20240528
          - almalinux:9.4-20240530
          - archlinux:base-devel-20240101.0.204074
          - debian:bookworm-20240513
          - debian:sid-20240513
          - rockylinux:8.9.20231119
          - rockylinux:9.3.20231119
        # python-version:
        #   - 3.7
        #   - 3.8
        #   - 3.9
        #   - '3.10'
        #   - 3.11
        #   - 3.12
      fail-fast: false
    steps:
      - uses: actions/checkout@v4
      - name: install system-level dependencies
        run: |
          bash ./install_system_level_dependencies.sh
      # TODO use to compile from source?
      # - uses: actions/setup-python@v5
      #   with:
      #     python-version: ${{ matrix.python-version }}
      - name: set JSON output file location (Unix)
        run: |
          echo "TRY_PLATFORM_OUTPUTFILE=${{ github.job }}.json" >> "${GITHUB_ENV}"
      - name: try calling platform code
        run: |
          bash ./execute_python.sh
      - name: save JSON output
        uses: actions/upload-artifact@v4
        with:
          name: ${{ github.job }}
          path: *.json
